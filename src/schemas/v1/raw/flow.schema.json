{
    "openapi": "3.1.0",
    "info": {
        "title": "Flow Engine API",
        "version": "1.0.0",
        "description": "Conversational Flow Engine REST API for managing conversational flows with Finite State Machines"
    },
    "components": {
        "schemas": {
            "AIHelper": {
                "type": "object",
                "description": "AIHelper configuration - flexible schema allowing any properties for future extensibility"
            },
            "AudioMediaConfig": {
                "type": "object",
                "required": [
                    "presetId"
                ],
                "allOf": [
                    {
                        "type": "object",
                        "properties": {
                            "presetId": {
                                "type": "string",
                                "description": "Reference to one of the preset of the platform. One is always present and it's called 'default'",
                                "default": "default"
                            }
                        }
                    },
                    {
                        "$ref": "#/components/schemas/BaseAudioMediaConfig"
                    }
                ]
            },
            "AudioMediaConfigPreset": {
                "type": "object",
                "required": [
                    "llm",
                    "stt",
                    "tts",
                    "vad",
                    "allowInterruptionsOnStart",
                    "allowInterruptions",
                    "enableRecording",
                    "userInteractionTimeout",
                    "preemptiveGeneration"
                ],
                "allOf": [
                    {
                        "$ref": "#/components/schemas/BaseAudioMediaConfig"
                    }
                ]
            },
            "BaseAudioMediaConfig": {
                "type": "object",
                "properties": {
                    "llm": {
                        "$ref": "#/components/schemas/LLMConfig"
                    },
                    "stt": {
                        "$ref": "#/components/schemas/STTConfig"
                    },
                    "tts": {
                        "$ref": "#/components/schemas/TTSConfig"
                    },
                    "vad": {
                        "$ref": "#/components/schemas/VADConfig"
                    },
                    "allowInterruptionsOnStart": {
                        "type": "boolean",
                        "description": "Controls if user can interrupt AI when playing the first message"
                    },
                    "allowInterruptions": {
                        "type": "boolean",
                        "description": "Controls if user can interrupt AI in messages after the first message played"
                    },
                    "courtesyMessageConfig": {
                        "description": "Contains the configuration for enabling courtesy messages. If not set, courtesy messages are disabled",
                        "anyOf": [
                            {
                                "$ref": "#/components/schemas/CourtesyMessageConfig"
                            },
                            {
                                "type": "null"
                            }
                        ]
                    },
                    "enableRecording": {
                        "type": "boolean",
                        "description": "Enables recording of the conversation",
                        "default": false
                    },
                    "userInteractionTimeout": {
                        "type": "number",
                        "description": "Maximum waiting time (in seconds) for user response before triggering a no_utterance event.",
                        "default": 20
                    },
                    "preemptiveGeneration": {
                        "type": "boolean",
                        "description": "If true, the LLM can start generating responses before the user finishes speaking.",
                        "default": false
                    }
                }
            },
            "BaseSTTConfig": {
                "type": "object",
                "required": [
                    "provider"
                ],
                "properties": {
                    "provider": {
                        "type": "string",
                        "pattern": "^google|deepgram|openai|{{ .+ }}$"
                    },
                    "recognitionTimeout": {
                        "type": "number",
                        "description": "Time to wait before issuing an unclear utterance message",
                        "default": 2.5
                    },
                    "streaming": {
                        "type": "boolean",
                        "description": "Enables or disables streaming STT mode.",
                        "default": false
                    },
                    "interimResults": {
                        "type": "boolean",
                        "description": "Enables interim (partial) recognition results during streaming.",
                        "default": false
                    },
                    "hints": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "description": "Optional vocabulary hints to improve speech recognition accuracy.",
                        "default": []
                    },
                    "hintsBoost": {
                        "type": "number",
                        "description": "Weight multiplier applied to hints.",
                        "default": 1
                    },
                    "minEndpointingDelay": {
                        "type": "number",
                        "description": "Minimum delay that is waited after user ends to speak and turn detection thinks the turn is ended",
                        "default": 1.5
                    },
                    "maxEndpointingDelay": {
                        "type": "number",
                        "description": "Maximum delay that is waited after user ends to speak and turn detection thinks the turn is NOT yet ended",
                        "default": 3
                    },
                    "minInterruptionDuration": {
                        "type": "number",
                        "description": "User must speak at least this duration to interrupt the bot speaking",
                        "default": 0.7
                    }
                }
            },
            "BaseTTSConfig": {
                "type": "object",
                "required": [
                    "provider",
                    "voice"
                ],
                "properties": {
                    "provider": {
                        "type": "string",
                        "pattern": "^google|elevenlabs|openai|{{ .+ }}$"
                    },
                    "voice": {
                        "type": "string",
                        "description": "(Template of) Voice ID according to provider specifications"
                    },
                    "speed": {
                        "type": "number",
                        "default": 1
                    }
                }
            },
            "Checkpoint": {
                "type": "object",
                "required": [
                    "_id",
                    "name",
                    "prompt"
                ],
                "properties": {
                    "_id": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string",
                        "description": "Name of the Checkpoint"
                    },
                    "prompt": {
                        "type": "string",
                        "description": "The LLM prompt used to identify the Checkpoint"
                    },
                    "required": {
                        "type": "boolean",
                        "description": "The flag that indicates if the current checkpoint is mandatory",
                        "default": false
                    }
                }
            },
            "ClosureConfig": {
                "type": "object",
                "required": [
                    "multiContact"
                ],
                "properties": {
                    "multiContact": {
                        "type": "boolean",
                        "description": "If it's false a conversation is closed when the contact that originated it terminates. If it's true, conversationTimeLimit and customHandler will determinate the behaviour at the end of a contact",
                        "default": false
                    },
                    "conversationTimeLimit": {
                        "type": "number",
                        "description": "Defines the maximum absolute duration of the conversation in seconds. Mandatory if multiContact is true"
                    },
                    "customHandler": {
                        "type": "string",
                        "pattern": "^https?://(?:www\\.)?[-a-zA-Z0-9@:%.+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b(?:[-a-zA-Z0-9()@:%+.~#?&/=]*)$",
                        "description": "Url that will respond true/false (close/don't close) when a contact terminate. Mandatory if multiContact is true"
                    }
                },
                "allOf": [
                    {
                        "if": {
                            "properties": {
                                "multiContact": {
                                    "const": true
                                }
                            },
                            "required": [
                                "multiContact"
                            ]
                        },
                        "then": {
                            "required": [
                                "conversationTimeLimit",
                                "customHandler"
                            ]
                        }
                    }
                ]
            },
            "ConversationalFlow": {
                "type": "object",
                "description": "It's the main record that declares the existance of a Conversational Flow within a campaign",
                "additionalProperties": false,
                "required": [
                    "_id",
                    "name",
                    "campaignId",
                    "schemaVersion",
                    "updatedBy",
                    "updatedAt"
                ],
                "properties": {
                    "_id": {
                        "type": "string",
                        "description": "MongoDB ID of the conversational flow"
                    },
                    "name": {
                        "type": "string",
                        "description": "Name of the Conversational Flow"
                    },
                    "campaignId": {
                        "type": "string",
                        "description": "Reference to the Campaign owning the Conversational Flow"
                    },
                    "schemaVersion": {
                        "$ref": "#/components/schemas/SchemaVersionString"
                    },
                    "updatedBy": {
                        "type": "string",
                        "description": "The user that created the Conversational Flow or updated it's name"
                    },
                    "updatedAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "ISO Timestamp when the last insert/update operation has been done"
                    }
                }
            },
            "ConversationalFlowTask": {
                "type": "object",
                "required": [
                    "_id",
                    "type",
                    "description",
                    "prompt",
                    "transitionParameters",
                    "mcpServers",
                    "closureConfig",
                    "enabledCheckpoints"
                ],
                "properties": {
                    "_id": {
                        "type": "string"
                    },
                    "type": {
                        "type": "string",
                        "enum": [
                            "AIO",
                            "AIS",
                            "HUM"
                        ],
                        "description": "The type of the current task: AI only (AIO), human (HUM) or AI supervised (AIS)"
                    },
                    "description": {
                        "type": "string",
                        "description": "The prompt used by the AI in order to move to the current task from a linked one"
                    },
                    "prompt": {
                        "type": "string",
                        "description": "The prompt used by the AI to describe the current task"
                    },
                    "transitionParameters": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/TransitionParameter"
                        }
                    },
                    "aiHelpers": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/AIHelper"
                        }
                    },
                    "channels": {
                        "description": "The list of the available channel. In case of null all channels are enabled",
                        "anyOf": [
                            {
                                "type": "array",
                                "items": {
                                    "type": "string",
                                    "enum": [
                                        "phone",
                                        "whatsapp",
                                        "sms",
                                        "mail",
                                        "chat"
                                    ]
                                }
                            },
                            {
                                "type": "null"
                            }
                        ]
                    },
                    "mcpToolSelection": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/MCPToolSelection"
                        },
                        "description": "The list of MCP Servers available for the current task"
                    },
                    "closureConfig": {
                        "$ref": "#/components/schemas/ClosureConfig",
                        "description": "A specific closure config to be used in the specific task. This configuration overrides the one set on the conversational flow."
                    },
                    "enabledCheckpoints": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/Checkpoint"
                        },
                        "description": "The list of selected checkpoint for the current task"
                    },
                    "connectedTasks": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "description": "Task ids connected to this one"
                    }
                }
            },
            "ConversationalFlowTaskAIO": {
                "properties": {
                    "hideTranscriptionToHuman": {
                        "type": "boolean",
                        "description": "Automatically hide transcriptions to human"
                    }
                },
                "allOf": [
                    {
                        "$ref": "#/components/schemas/ConversationalFlowTask"
                    }
                ]
            },
            "ConversationalFlowTaskAIS": {
                "allOf": [
                    {
                        "$ref": "#/components/schemas/ConversationalFlowTaskHUM"
                    }
                ]
            },
            "ConversationalFlowTaskHUM": {
                "required": [
                    "routingParameters"
                ],
                "properties": {
                    "routingParameters": {
                        "$ref": "#/components/schemas/RoutingParameters"
                    }
                },
                "allOf": [
                    {
                        "$ref": "#/components/schemas/ConversationalFlowTask"
                    }
                ]
            },
            "ConversationalFlowVersion": {
                "type": "object",
                "description": "It's a version of a conversational flow defined in ConversationalFlow with all the settings needed to render in the UI and also to have a working FSM",
                "additionalProperties": false,
                "required": [
                    "draft"
                ],
                "properties": {
                    "_id": {
                        "type": "string",
                        "description": "MongoDB ID of the conversational flow version"
                    },
                    "schemaVersion": {
                        "$ref": "#/components/schemas/SchemaVersionString"
                    },
                    "conversationalFlowId": {
                        "type": "string",
                        "description": "Reference to the Conversational Flow"
                    },
                    "globalPrompt": {
                        "type": "string",
                        "description": "It's the main prompt that defines the rules of the conversation. It's rendered in every prompt sent to LLM. The template format is the one used by n8n tournament rendering engine."
                    },
                    "channels": {
                        "type": "array",
                        "items": {
                            "type": "string",
                            "enum": [
                                "phone",
                                "whatsapp",
                                "sms",
                                "mail",
                                "chat"
                            ]
                        }
                    },
                    "mandatoryChannels": {
                        "type": "array",
                        "items": {
                            "type": "string",
                            "enum": [
                                "phone",
                                "whatsapp",
                                "sms",
                                "mail",
                                "chat"
                            ]
                        }
                    },
                    "closureConfig": {
                        "$ref": "#/components/schemas/ClosureConfig"
                    },
                    "mediaConfig": {
                        "$ref": "#/components/schemas/MediaConfig"
                    },
                    "languageDetection": {
                        "$ref": "#/components/schemas/LanguageDetectionConfig"
                    },
                    "defaultLanguage": {
                        "$ref": "#/components/schemas/LanguageCode",
                        "description": "Default language when a new conversation starts"
                    },
                    "supportedLanguages": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/LanguageCode"
                        },
                        "description": "Languages supported by the conversational flow"
                    },
                    "systemPromptsLanguage": {
                        "$ref": "#/components/schemas/LanguageCode",
                        "description": "Language used to build the system prompts. The available ones are: it-IT, en-US, es-ES. In case defaultLanguage contains a different language value, the default is en-US."
                    },
                    "apiVersion": {
                        "type": "string",
                        "pattern": "^v[0-9]+$",
                        "description": "The current version of the system api"
                    },
                    "variables": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/Variable"
                        }
                    },
                    "uiMetadata": {
                        "type": "object",
                        "description": "The object containing the UI metadata"
                    },
                    "mcpServers": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/MCPServer"
                        },
                        "description": "The list of MCP Servers available for the current conversational flow"
                    },
                    "aiHelpers": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/AIHelper"
                        }
                    },
                    "tasks": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/ConversationalFlowTask"
                        }
                    },
                    "firstTask": {
                        "type": "string",
                        "description": "Id of the first task to be executed in the flow"
                    },
                    "checkpoints": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/Checkpoint"
                        },
                        "description": "The list of defined checkpoint for the current conversational flow"
                    },
                    "reasonsOfContact": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "required": [
                                "name",
                                "prompt"
                            ],
                            "properties": {
                                "name": {
                                    "type": "string",
                                    "description": "Declared reason of contact"
                                },
                                "prompt": {
                                    "type": "string",
                                    "description": "The prompt used by the AI in order to choose the reason of contact"
                                }
                            }
                        },
                        "description": "The list of available reasons of contact"
                    },
                    "results": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "required": [
                                "name",
                                "prompt",
                                "resultTypes"
                            ],
                            "properties": {
                                "name": {
                                    "type": "string",
                                    "description": "Declared result"
                                },
                                "prompt": {
                                    "type": "string",
                                    "description": "The prompt used by the AI in order to choose the result"
                                },
                                "resultTypes": {
                                    "type": "array",
                                    "items": {
                                        "type": "string",
                                        "enum": [
                                            "CL",
                                            "UNC",
                                            "UC",
                                            "Y",
                                            "UPS"
                                        ]
                                    }
                                }
                            }
                        },
                        "description": "The list of results"
                    },
                    "createdBy": {
                        "type": "string",
                        "description": "The user that created the current flow version"
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "ISO Timestamp when the current conversational flow version has been created"
                    },
                    "draft": {
                        "type": "boolean",
                        "description": "If draft is true all other fields are not required",
                        "default": false
                    }
                },
                "allOf": [
                    {
                        "if": {
                            "properties": {
                                "draft": {
                                    "const": false
                                }
                            },
                            "required": [
                                "draft"
                            ]
                        },
                        "then": {
                            "required": [
                                "_id",
                                "schemaVersion",
                                "conversationalFlowId",
                                "globalPrompt",
                                "channels",
                                "mandatoryChannels",
                                "closureConfig",
                                "mediaConfig",
                                "defaultLanguage",
                                "supportedLanguages",
                                "systemPromptsLanguage",
                                "apiVersion",
                                "variables",
                                "uiMetadata",
                                "mcpServers",
                                "aiHelpers",
                                "tasks",
                                "firstTask",
                                "checkpoints",
                                "reasonsOfContact",
                                "results",
                                "createdBy",
                                "createdAt"
                            ]
                        }
                    }
                ]
            },
            "CourtesyMessageConfig": {
                "type": "object",
                "required": [
                    "provider",
                    "providerParams",
                    "timeout"
                ],
                "properties": {
                    "provider": {
                        "type": "string",
                        "enum": [
                            "groq",
                            "random"
                        ]
                    },
                    "timeout": {
                        "type": "number",
                        "description": "Time interval (seconds) before playing the courtesy message"
                    },
                    "silenceAfterMessage": {
                        "type": "number",
                        "description": "Time interval (seconds) to wait before playing the AI message after a courtesy message",
                        "default": 1
                    },
                    "providerParams": {
                        "oneOf": [
                            {
                                "$ref": "#/components/schemas/CourtesyMessageGroqParams"
                            },
                            {
                                "$ref": "#/components/schemas/CourtesyMessageRandomParams"
                            }
                        ]
                    }
                }
            },
            "CourtesyMessageGroqParams": {
                "type": "object",
                "properties": {
                    "historyMessages": {
                        "type": "number",
                        "description": "Number of previous messages to include in the courtesy message prompt context",
                        "default": 5
                    },
                    "prompt": {
                        "type": "string",
                        "description": "Prompt used to generate the courtesy message",
                        "default": "[Prompt defined by the system]"
                    },
                    "temperature": {
                        "type": "number",
                        "description": "Creativity level of the LLM when generating the courtesy message",
                        "default": 0.2
                    },
                    "maxCompletionTokens": {
                        "type": "number",
                        "description": "Max number of tokens for the generated courtesy message",
                        "default": 30
                    },
                    "topP": {
                        "type": "number",
                        "description": "Nucleus sampling parameter for the generated courtesy message",
                        "default": 0.8
                    },
                    "model": {
                        "type": "string",
                        "enum": [
                            "meta-llama/llama-4-scout-17b-16e-instruct"
                        ],
                        "description": "AI Model used for courtesy message generation. Any model supported by groq is accepted.",
                        "default": "meta-llama/llama-4-scout-17b-16e-instruct"
                    }
                }
            },
            "CourtesyMessageRandomParams": {
                "type": "object",
                "properties": {
                    "messages": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/LocalizedText"
                        }
                    }
                }
            },
            "LLMConfig": {
                "type": "object",
                "properties": {
                    "provider": {
                        "type": "string",
                        "enum": [
                            "openai",
                            "azure",
                            "google",
                            "local",
                            "groq"
                        ]
                    },
                    "model": {
                        "type": "string",
                        "description": "Reference to one the models provided by SmileCX"
                    },
                    "temperature": {
                        "type": "number",
                        "description": "Defines the \"creativity\" of the AI Model"
                    }
                }
            },
            "LanguageCode": {
                "type": "string",
                "description": "Array of languages in BCP 47 format (ISO 639-1 + ISO 3166-1).",
                "example": "it-IT or en-US"
            },
            "LanguageDetectionConfig": {
                "type": "object",
                "properties": {
                    "enableLanguageDetection": {
                        "type": "boolean",
                        "description": "Enables automatic language detection from user input.",
                        "default": false
                    },
                    "minWordsForLanguageDetection": {
                        "type": "number",
                        "description": "Minimum number of words required to attempt language detection.",
                        "default": 2
                    },
                    "languageDetector": {
                        "type": "string",
                        "enum": [
                            "fasttext",
                            "lingua"
                        ],
                        "description": "Algorithm used for language detection. Supported: \"fasttext\", \"lingua\".",
                        "default": "fasttext"
                    }
                }
            },
            "LanguageSTTConfig": {
                "type": "object",
                "properties": {
                    "language": {
                        "type": "string",
                        "description": "Language in ISO 639-1 - two chars (en, it, ..)"
                    },
                    "config": {
                        "$ref": "#/components/schemas/BaseSTTConfig"
                    }
                }
            },
            "LanguageTTSConfig": {
                "type": "object",
                "properties": {
                    "language": {
                        "type": "string",
                        "description": "Language in ISO 639-1 - two chars (en, it, ..)"
                    },
                    "config": {
                        "$ref": "#/components/schemas/BaseTTSConfig"
                    }
                }
            },
            "LocalizedText": {
                "type": "object",
                "required": [
                    "language",
                    "text"
                ],
                "properties": {
                    "language": {
                        "type": "string",
                        "description": "Language in ISO 639-1 - two chars (en, it, ..)"
                    },
                    "text": {
                        "type": "string"
                    }
                }
            },
            "MCPServer": {
                "type": "object",
                "required": [
                    "name",
                    "url",
                    "includedTools"
                ],
                "properties": {
                    "name": {
                        "type": "string",
                        "description": "Name of the MCPServer"
                    },
                    "url": {
                        "type": "string",
                        "pattern": "^https?://(?:www\\.)?[-a-zA-Z0-9@:%.+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b(?:[-a-zA-Z0-9()@:%+.~#?&/=]*)$",
                        "description": "The url of the current MCPServer"
                    },
                    "includedTools": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "toolName": {
                                    "type": "string",
                                    "description": "Name of the specific tool"
                                },
                                "uiToolDescription": {
                                    "type": "string",
                                    "description": "The description of the specific tool for selecting in the UI"
                                }
                            }
                        },
                        "description": "The list of tools selected inside the specific MCP Server"
                    }
                }
            },
            "MCPToolParameter": {
                "type": "object",
                "required": [
                    "parameterName",
                    "assignmentStrategy",
                    "assignmentValue"
                ],
                "properties": {
                    "parameterName": {
                        "type": "string",
                        "description": "The name of the parameter"
                    },
                    "assignmentStrategy": {
                        "type": "string",
                        "enum": [
                            "variable",
                            "fixed",
                            "prompt"
                        ],
                        "description": "The strategy used for assigning the value"
                    },
                    "assignmentValue": {
                        "type": "string",
                        "description": "This depends on assignmentStrategy, it could be : <br/>- a variable id <br/>- a fixed value <br/>- a prompt for helping the ai on calculate the real value that should be passed"
                    }
                }
            },
            "MCPToolParametersMap": {
                "type": "object",
                "required": [
                    "toolName"
                ],
                "properties": {
                    "toolName": {
                        "type": "string",
                        "description": "The name of the tool in the MCP Server"
                    },
                    "toolParameters": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/MCPToolParameter"
                        },
                        "description": "The list of parameters for the tools selected"
                    }
                }
            },
            "MCPToolSelection": {
                "type": "object",
                "required": [
                    "mcpServerName",
                    "selectedTools"
                ],
                "properties": {
                    "mcpServerName": {
                        "type": "string",
                        "description": "The MCP Server name from the list of MCP Servers supplied by the conversational flow"
                    },
                    "selectedTools": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/MCPToolParametersMap"
                        },
                        "description": "The list of tools selected for this MCP Server"
                    }
                }
            },
            "MediaConfig": {
                "type": "object",
                "required": [
                    "audio",
                    "text"
                ],
                "properties": {
                    "audio": {
                        "$ref": "#/components/schemas/AudioMediaConfig"
                    },
                    "text": {
                        "$ref": "#/components/schemas/TextMediaConfig"
                    }
                }
            },
            "RoutingParameters": {
                "type": "object",
                "required": [
                    "timeout"
                ],
                "properties": {
                    "timeout": {
                        "type": "number",
                        "description": "Time to wait before considering the routing request failed (no answer by agents)"
                    },
                    "agentSkills": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "description": "Skills required by the routing request"
                    },
                    "agentOptionalSkills": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "description": "Optional skills required by the routing request"
                    },
                    "agentIds": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "description": "Specific agents required by the routing request"
                    },
                    "waitingMusic": {
                        "type": "string",
                        "pattern": "^https?://(?:www\\.)?[-a-zA-Z0-9@:%.+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b(?:[-a-zA-Z0-9()@:%+.~#?&/=]*)$",
                        "description": "Url to specific music to play during waiting"
                    },
                    "waitingMusicDuration": {
                        "type": "number",
                        "description": "Interval between waiting messages"
                    },
                    "waitingMessagesConfiguration": {
                        "$ref": "#/components/schemas/WaitingMessagesConfiguration"
                    }
                }
            },
            "STTConfig": {
                "type": "object",
                "required": [
                    "default",
                    "fallback"
                ],
                "properties": {
                    "default": {
                        "$ref": "#/components/schemas/BaseSTTConfig"
                    },
                    "fallback": {
                        "$ref": "#/components/schemas/BaseSTTConfig"
                    },
                    "languageCustomConfig": {
                        "anyOf": [
                            {
                                "type": "array",
                                "items": {
                                    "$ref": "#/components/schemas/LanguageSTTConfig"
                                }
                            },
                            {
                                "type": "null"
                            }
                        ]
                    }
                }
            },
            "SchemaVersionString": {
                "type": "string",
                "description": "Version of the object schema to handle future schema updates or migrations",
                "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
                "example": "1.0.0"
            },
            "TTSConfig": {
                "type": "object",
                "required": [
                    "default",
                    "fallback"
                ],
                "properties": {
                    "default": {
                        "$ref": "#/components/schemas/BaseTTSConfig"
                    },
                    "fallback": {
                        "$ref": "#/components/schemas/BaseTTSConfig"
                    },
                    "languageCustomConfig": {
                        "anyOf": [
                            {
                                "type": "array",
                                "items": {
                                    "$ref": "#/components/schemas/LanguageTTSConfig"
                                }
                            },
                            {
                                "type": "null"
                            }
                        ]
                    }
                }
            },
            "TextMediaConfig": {
                "type": "object",
                "properties": {
                    "llm": {
                        "$ref": "#/components/schemas/LLMConfig"
                    },
                    "courtesyMessageConfig": {
                        "description": "Contains the configuration for enabling courtesy messages. If not set, courtesy messages are disabled",
                        "anyOf": [
                            {
                                "$ref": "#/components/schemas/CourtesyMessageConfig"
                            },
                            {
                                "type": "null"
                            }
                        ]
                    },
                    "userInteractionTimeout": {
                        "description": "Maximum waiting time (in seconds) for user response before triggering a no_utterance event. (default: never)",
                        "anyOf": [
                            {
                                "type": "number"
                            },
                            {
                                "type": "null"
                            }
                        ]
                    }
                }
            },
            "TransitionParameter": {
                "type": "object",
                "required": [
                    "variableId",
                    "required"
                ],
                "properties": {
                    "variableId": {
                        "type": "string",
                        "description": "The id of the variable selected from the available variables for the conversational flow"
                    },
                    "required": {
                        "type": "boolean"
                    }
                }
            },
            "VADConfig": {
                "type": "object",
                "properties": {
                    "activationThreshold": {
                        "type": "number",
                        "description": "Threshold to consider a frame as speech.",
                        "default": 0.5
                    },
                    "maxBufferedSpeech": {
                        "type": "number",
                        "description": "Maximum duration of speech to keep in the buffer (in seconds).",
                        "default": 60
                    },
                    "minSilenceDuration": {
                        "type": "number",
                        "description": "At the end of each speech, wait this duration before ending the speech.",
                        "default": 0.8
                    },
                    "minSpeechDuration": {
                        "type": "number",
                        "description": "Minimum duration of speech to start a new speech chunk.",
                        "default": 0.08
                    },
                    "prefixPaddingDuration": {
                        "type": "number",
                        "description": "Duration of padding to add to the beginning of each speech chunk.",
                        "default": 0.5
                    }
                }
            },
            "Variable": {
                "type": "object",
                "required": [
                    "_id",
                    "name",
                    "type"
                ],
                "properties": {
                    "_id": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string",
                        "description": "Variable name"
                    },
                    "type": {
                        "type": "string",
                        "enum": [
                            "string",
                            "number",
                            "boolean",
                            "enum",
                            "date",
                            "phone",
                            "custom"
                        ],
                        "description": "Variable type"
                    },
                    "enumValues": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "prompt": {
                        "type": "string",
                        "description": "The prompt used by the AI in order to identify the variable"
                    }
                },
                "if": {
                    "not": {
                        "properties": {
                            "type": {
                                "const": "custom"
                            }
                        }
                    }
                },
                "then": {
                    "required": [
                        "prompt"
                    ]
                }
            },
            "WaitingMessagesConfiguration": {
                "type": "object",
                "required": [
                    "generationStrategy"
                ],
                "properties": {
                    "generationStrategy": {
                        "type": "string",
                        "enum": [
                            "fixed",
                            "prompt"
                        ],
                        "description": "Strategy to generate waiting messages"
                    },
                    "prompt": {
                        "type": "string",
                        "description": "Prompt for generating waiting messages"
                    },
                    "messagesList": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/LocalizedText"
                        }
                    }
                },
                "if": {
                    "properties": {
                        "generationStrategy": {
                            "const": "prompt"
                        }
                    }
                },
                "then": {
                    "required": [
                        "prompt"
                    ]
                },
                "else": {
                    "required": [
                        "messagesList"
                    ]
                }
            }
        }
    }
}